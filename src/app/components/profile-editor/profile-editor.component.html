<div
  class="p-6 h-full overflow-y-auto bg-neutral-900 text-white"
  [ngStyle]="{ 'border-color': theme().primary, color: theme().primary }"
>
  <!-- Authenticated View -->
  <div *ngIf="isAuthenticated() && currentUser() as user; else guestView">
    <!-- Main Profile View -->
    <div class="flex gap-8">
      <!-- Sidebar Menu -->
      <div class="w-1/4 sticky top-0 self-start">
        <div class="bg-neutral-800 p-4 rounded-lg shadow-lg">
          <nav class="flex flex-col gap-2">
            <button
              *ngFor="let section of sections"
              (click)="activeSection.set(section.id)"
              [class.active-section]="activeSection() === section.id"
              class="text-left p-3 rounded-md transition-colors text-neutral-300 hover:bg-neutral-700/50 flex items-center gap-3"
            >
              <i
                class="fas text-lg w-6 text-center"
                [ngClass]="section.icon"
                [style.color]="theme().accent"
              ></i>
              <span>{{ section.label }}</span>
            </button>
          </nav>
        </div>
      </div>

      <!-- Content -->
      <div class="w-3/4">
        <div class="bg-neutral-800 p-8 rounded-lg shadow-lg">
          <ng-container *ngFor="let section of sections">
            <div *ngIf="activeSection() === section.id" class="animate-fade-in">
              <h3
                class="text-2xl font-bold mb-6 flex items-center gap-3"
                [style.color]="theme().primary"
              >
                <i class="fas" [ngClass]="section.icon"></i>
                {{ section.label }}
              </h3>

              <!-- Social & Links Section -->
              <div *ngIf="section.id === 'social'" class="space-y-6">
                <!-- Social Media -->
                <app-form-field
                  label="Social Media"
                  description="Your official social media profiles."
                >
                  <div class="space-y-3">
                    <div
                      *ngFor="
                        let platform of objectKeys(
                          editableProfile().socialMedia
                        )
                      "
                      class="flex items-center gap-2"
                    >
                      <label class="w-24 capitalize">{{ platform }}</label>
                      <input
                        type="text"
                        [value]="editableProfile().socialMedia[platform]"
                        (input)="updateLink('socialMedia', platform, $event)"
                        class="flex-grow p-2 bg-neutral-700 rounded-md"
                      />
                      <button
                        (click)="removeLink('socialMedia', platform)"
                        class="px-2 py-1 text-red-500"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                    <div class="flex items-center gap-2">
                      <select
                        #newSocialPlatform
                        class="p-2 bg-neutral-700 rounded-md"
                      >
                        <option
                          *ngFor="let platform of socialPlatforms"
                          [value]="platform"
                        >
                          {{ platform }}
                        </option>
                      </select>
                      <button
                        (click)="
                          addLink('socialMedia', newSocialPlatform.value)
                        "
                        class="px-3 py-2 bg-blue-600 rounded-md"
                      >
                        Add
                      </button>
                    </div>
                  </div>
                </app-form-field>

                <!-- Music Platforms -->
                <app-form-field
                  label="Music Platforms"
                  description="Links to your music on streaming services."
                >
                  <div class="space-y-3">
                    <div
                      *ngFor="
                        let platform of objectKeys(
                          editableProfile().musicPlatforms
                        )
                      "
                      class="flex items-center gap-2"
                    >
                      <label class="w-24 capitalize">{{ platform }}</label>
                      <input
                        type="text"
                        [value]="editableProfile().musicPlatforms[platform]"
                        (input)="updateLink('musicPlatforms', platform, $event)"
                        class="flex-grow p-2 bg-neutral-700 rounded-md"
                      />
                      <button
                        (click)="removeLink('musicPlatforms', platform)"
                        class="px-2 py-1 text-red-500"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                    <div class="flex items-center gap-2">
                      <select
                        #newMusicPlatform
                        class="p-2 bg-neutral-700 rounded-md"
                      >
                        <option
                          *ngFor="let platform of musicPlatforms"
                          [value]="platform"
                        >
                          {{ platform }}
                        </option>
                      </select>
                      <button
                        (click)="
                          addLink('musicPlatforms', newMusicPlatform.value)
                        "
                        class="px-3 py-2 bg-blue-600 rounded-md"
                      >
                        Add
                      </button>
                    </div>
                  </div>
                </app-form-field>
              </div>

              <!-- Legal Docs Section -->
              <div *ngIf="section.id === 'legal'" class="space-y-6">
                <div class="flex justify-between items-center">
                  <p class="text-neutral-400">
                    Create and manage your legal document templates.
                  </p>
                  <button (click)="openNewDocument()" class="action-button">
                    New Document
                  </button>
                </div>
                <div class="space-y-4">
                  <div
                    *ngFor="let doc of editableProfile().legalDocuments"
                    class="bg-neutral-700/50 p-4 rounded-lg flex justify-between items-center"
                  >
                    <span class="font-bold">{{ doc.title }}</span>
                    <div class="flex gap-2">
                      <button
                        (click)="openEditDocument(doc)"
                        class="px-3 py-1 bg-blue-600 rounded-md"
                      >
                        Edit
                      </button>
                      <button
                        (click)="deleteLegalDocument(doc.id)"
                        class="px-3 py-1 bg-red-600 rounded-md"
                      >
                        Delete
                      </button>
                    </div>
                  </div>
                  <p
                    *ngIf="!editableProfile().legalDocuments?.length"
                    class="text-center text-neutral-500"
                  >
                    No legal documents yet.
                  </p>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <!-- Legal Document Editor Modal -->
  <div *ngIf="showLegalEditor()" class="modal-overlay">
    <app-legal-document-editor
      [document]="editingDocument()"
      (save)="saveLegalDocument($event)"
      (cancel)="showLegalEditor.set(false)"
    >
    </app-legal-document-editor>
  </div>
  <!-- Guest View -->
  <ng-template #guestView>
    <div class="guest-container wow animate__animated animate__fadeIn">
      <div class="guest-welcome">
        <h2>Welcome to S.M.U.V.E 2.0</h2>
        <p>The Ultimate Strategic Music Utility Virtual Enhancer. Your journey to the top starts here.</p>

        <div class="guest-features">
          <div class="feature-card">
            <i class="fas fa-microphone-alt"></i>
            <h3>The Studio</h3>
            <p>Professional DAW with high-precision mixer, synth, and mastering suite.</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-robot"></i>
            <h3>AI Strategic Partner</h3>
            <p>Get actionable "Strategic Decrees" from our omniscient Rap GOD AI.</p>
          </div>
          <div class="feature-card">
            <i class="fas fa-gamepad"></i>
            <h3>Tha Spot</h3>
            <p>Interactive gaming hub and AI-powered live jam sessions.</p>
          </div>
        </div>

        <div class="guest-actions">
          <button routerLink="/login" class="cta-button primary">Get Started</button>
          <button class="cta-button secondary" (click)="activeSection.set('about')">Learn More</button>
        </div>
      </div>
    </div>
  </ng-template>
</div>
