<div class="w-full h-full flex flex-col bg-gradient-to-br from-black via-purple-950/20 to-black" [style.color]="'var(--text-color)'">
  
  <!-- ========================================== -->
  <!-- LOGIN / REGISTER SCREEN (When NOT Authenticated) -->
  <!-- ========================================== -->
  <div *ngIf="!isAuthenticated()" class="flex-grow flex items-center justify-center p-6">
    <div class="w-full max-w-md">
      
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2" [style.color]="theme().accent">S.M.U.V.E. 2.0</h1>
        <p class="text-sm opacity-70">Strategic Music Utility Virtual Enhancer</p>
        <div class="mt-4 p-4 border rounded-lg" [style.border-color]="theme().accent + '40'" [style.background]="theme().accent + '10'">
          <p class="text-xs leading-relaxed">
            The more you tell S.M.U.V.E. about your journey, the more powerful and personalized your AI music manager becomes. 
            Unlock unmatched strategies, production tips, and career guidance tailored specifically to YOU.
          </p>
        </div>
      </div>

      <!-- Tab Switcher -->
      <div class="flex border-b-2 mb-6" [style.border-color]="theme().accent + '30'">
        <button (click)="authMode.set('login')" 
                class="flex-1 py-3 font-bold transition-all"
                [class.border-b-4]="authMode() === 'login'"
                [style.border-color]="authMode() === 'login' ? theme().accent : 'transparent'"
                [style.color]="authMode() === 'login' ? theme().accent : 'inherit'">
          LOGIN
        </button>
        <button (click)="authMode.set('register')" 
                class="flex-1 py-3 font-bold transition-all"
                [class.border-b-4]="authMode() === 'register'"
                [style.border-color]="authMode() === 'register' ? theme().accent : 'transparent'"
                [style.color]="authMode() === 'register' ? theme().accent : 'inherit'">
          REGISTER
        </button>
      </div>

      <!-- Error/Success Messages -->
      <div *ngIf="authError()" class="mb-4 p-3 border-2 border-red-500 bg-red-500/10 rounded-lg">
        <p class="text-sm text-red-400">{{ authError() }}</p>
      </div>
      <div *ngIf="authSuccess()" class="mb-4 p-3 border-2 border-green-500 bg-green-500/10 rounded-lg">
        <p class="text-sm text-green-400">{{ authSuccess() }}</p>
      </div>

      <!-- LOGIN FORM -->
      <div *ngIf="authMode() === 'login'" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Email</label>
          <input type="email" 
                 [value]="loginEmail()" 
                 (input)="loginEmail.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="your.email@example.com">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Password</label>
          <input type="password" 
                 [value]="loginPassword()" 
                 (input)="loginPassword.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 (keyup.enter)="handleLogin()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="••••••••">
        </div>

        <button (click)="handleLogin()" 
                [disabled]="authLoading()"
                class="w-full p-4 border-2 rounded-lg font-bold text-lg transition-all hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
                [style.border-color]="theme().accent"
                [style.background]="theme().accent + '20'"
                [class.hover:bg-purple-600]="!authLoading()">
          <span *ngIf="!authLoading()">ENTER S.M.U.V.E.</span>
          <span *ngIf="authLoading()" class="flex items-center justify-center gap-2">
            <i class="fas fa-spinner fa-spin"></i> AUTHENTICATING...
          </span>
        </button>
      </div>

      <!-- REGISTER FORM -->
      <div *ngIf="authMode() === 'register'" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">Artist Name *</label>
          <input type="text" 
                 [value]="registerArtistName()" 
                 (input)="registerArtistName.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="Your artist/stage name">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Email *</label>
          <input type="email" 
                 [value]="registerEmail()" 
                 (input)="registerEmail.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="your.email@example.com">
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-2">Password * (min 6 characters)</label>
          <input type="password" 
                 [value]="registerPassword()" 
                 (input)="registerPassword.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="••••••••">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2">Confirm Password *</label>
          <input type="password" 
                 [value]="registerConfirmPassword()" 
                 (input)="registerConfirmPassword.set($any($event.target).value)"
                 [disabled]="authLoading()"
                 (keyup.enter)="handleRegister()"
                 class="w-full p-3 bg-black/50 border-2 rounded-lg focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="••••••••">
        </div>

        <button (click)="handleRegister()" 
                [disabled]="authLoading()"
                class="w-full p-4 border-2 rounded-lg font-bold text-lg transition-all hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
                [style.border-color]="theme().accent"
                [style.background]="theme().accent + '20'"
                [class.hover:bg-purple-600]="!authLoading()">
          <span *ngIf="!authLoading()">BEGIN YOUR JOURNEY</span>
          <span *ngIf="authLoading()" class="flex items-center justify-center gap-2">
            <i class="fas fa-spinner fa-spin"></i> CREATING ACCOUNT...
          </span>
        </button>

        <p class="text-xs text-center opacity-60 mt-4">
          By registering, you agree to let S.M.U.V.E. guide your musical destiny.
        </p>
      </div>

    </div>
  </div>

  <!-- ========================================== -->
  <!-- PROFILE EDITOR (When Authenticated) -->
  <!-- ========================================== -->
  <div *ngIf="isAuthenticated()" class="flex-grow flex flex-col">
    
    <!-- Header -->
    <div class="border-b-2 p-4 bg-black/50" [style.border-color]="theme().accent">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold tracking-wider" [style.color]="theme().accent">
            S.M.U.V.E. ARTIST PROFILE
          </h2>
          <p class="text-sm mt-1 opacity-70">
            Logged in as: {{ currentUser()?.artistName }} ({{ currentUser()?.email }})
          </p>
        </div>
        <div class="text-right">
          <div class="flex items-center gap-3 mb-2">
            <span class="text-sm">Profile Completeness:</span>
            <div class="w-32 h-2 bg-black/50 rounded-full overflow-hidden border" [style.border-color]="theme().accent + '40'">
              <div class="h-full transition-all duration-500" 
                   [style.width.%]="profileCompleteness()"
                   [style.background]="theme().accent"></div>
            </div>
            <span class="font-bold" [style.color]="theme().accent">{{ profileCompleteness() }}%</span>
          </div>
          <button (click)="handleLogout()" 
                  class="text-sm px-3 py-1 border rounded hover:bg-white/10 transition-all"
                  [style.border-color]="theme().accent + '50'">
            <i class="fas fa-sign-out-alt mr-1"></i> Logout
          </button>
        </div>
      </div>
      <p class="text-center text-xs mt-3 opacity-70">
        The more details you provide, the better S.M.U.V.E. can tailor its advice, recommendations, and strategies to your unique journey.
      </p>
    </div>

    <!-- Navigation Tabs -->
    <div class="flex overflow-x-auto border-b-2 bg-black/30 scrollbar-thin" [style.border-color]="theme().accent + '40'">
      <button *ngFor="let section of sections" 
              (click)="activeSection.set(section.id)"
              [class.border-b-4]="activeSection() === section.id"
              [style.border-color]="activeSection() === section.id ? theme().accent : 'transparent'"
              [style.background]="activeSection() === section.id ? theme().accent + '20' : 'transparent'"
              class="px-4 py-3 text-sm whitespace-nowrap hover:bg-white/5 transition-all flex items-center gap-2">
        <i class="fas" [ngClass]="section.icon"></i>
        <span>{{ section.label }}</span>
      </button>
    </div>

    <!-- Voice Input Indicator (Global) -->
    <div *ngIf="isRecording()" class="bg-red-600 text-white p-2 text-center animate-pulse">
      <i class="fas fa-microphone mr-2"></i>
      Recording for: {{ recordingField() }} - Speak now...
      <button (click)="stopVoiceInput()" class="ml-4 px-3 py-1 bg-black/30 rounded hover:bg-black/50">
        Stop
      </button>
    </div>

    <!-- Content Area -->
    <div class="flex-grow overflow-y-auto p-6 space-y-8">
      
      <!-- BASIC INFO SECTION -->
      <div *ngIf="activeSection() === 'basic'" class="space-y-6 animate-fadeIn">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2" [style.color]="theme().accent">
          <i class="fas fa-user"></i> Basic Information
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-group">
            <label class="block text-sm font-medium mb-2 flex items-center justify-between">
              <span>Artist/Real Name *</span>
              <button *ngIf="voiceSupported()" 
                      (click)="startVoiceInput('artistName')"
                      [disabled]="isRecording()"
                      class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                      [style.border-color]="theme().accent"
                      title="Use voice input">
                <i class="fas fa-microphone"></i>
              </button>
            </label>
            <input type="text" [value]="editableProfile().artistName" (input)="updateField('artistName', $event)" 
                   class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                   [style.border-color]="theme().accent + '50'"
                   placeholder="Your legal or artist name">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium mb-2 flex items-center justify-between">
              <span>Stage Name (if different)</span>
              <button *ngIf="voiceSupported()" 
                      (click)="startVoiceInput('stageName')"
                      [disabled]="isRecording()"
                      class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                      [style.border-color]="theme().accent"
                      title="Use voice input">
                <i class="fas fa-microphone"></i>
              </button>
            </label>
            <input type="text" [value]="editableProfile().stageName" (input)="updateField('stageName', $event)" 
                   class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                   [style.border-color]="theme().accent + '50'"
                   placeholder="Your performance name">
          </div>
        </div>

        <div class="form-group">
          <label class="block text-sm font-medium mb-2 flex items-center justify-between">
            <span>Location</span>
            <button *ngIf="voiceSupported()" 
                    (click)="startVoiceInput('location')"
                    [disabled]="isRecording()"
                    class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                    [style.border-color]="theme().accent"
                    title="Use voice input">
              <i class="fas fa-microphone"></i>
            </button>
          </label>
          <input type="text" [value]="editableProfile().location" (input)="updateField('location', $event)" 
                 class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                 [style.border-color]="theme().accent + '50'"
                 placeholder="City, State, Country">
        </div>

        <div class="form-group">
          <label class="block text-sm font-medium mb-2 flex items-center justify-between">
            <span>Your Musical Journey / Bio</span>
            <button *ngIf="voiceSupported()" 
                    (click)="startVoiceInput('bio')"
                    [disabled]="isRecording()"
                    class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                    [style.border-color]="theme().accent"
                    title="Use voice input">
              <i class="fas fa-microphone"></i> Voice Input
            </button>
          </label>
          <textarea [value]="editableProfile().bio" (input)="updateField('bio', $event)" 
                    rows="5" 
                    class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                    [style.border-color]="theme().accent + '50'"
                    placeholder="Tell S.M.U.V.E. about your story, how you got started, what drives you..."></textarea>
          <p class="text-xs opacity-60 mt-1">
            <i class="fas fa-info-circle"></i> This helps S.M.U.V.E. understand your unique background and motivations. Use voice input for faster entry!
          </p>
        </div>
      </div>

      <!-- Note: Other sections remain the same from previous implementation, just add voice buttons where appropriate -->
      <!-- I'll show voice buttons for a couple more key fields as examples -->

      <!-- MUSICAL IDENTITY SECTION -->
      <div *ngIf="activeSection() === 'musical'" class="space-y-6 animate-fadeIn">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2" [style.color]="theme().accent">
          <i class="fas fa-music"></i> Musical Identity
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-group">
            <label class="block text-sm font-medium mb-2 flex items-center justify-between">
              <span>Primary Genre *</span>
              <button *ngIf="voiceSupported()" 
                      (click)="startVoiceInput('primaryGenre')"
                      [disabled]="isRecording()"
                      class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                      [style.border-color]="theme().accent">
                <i class="fas fa-microphone"></i>
              </button>
            </label>
            <select [value]="editableProfile().primaryGenre" (change)="updateField('primaryGenre', $event)"
                    class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all"
                    [style.border-color]="theme().accent + '50'">
              <option value="">Select your main genre</option>
              <option *ngFor="let genre of ALL_GENRES" [value]="genre">{{ genre }}</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium mb-2 flex items-center justify-between">
              <span>What Makes Your Sound Unique?</span>
              <button *ngIf="voiceSupported()" 
                      (click)="startVoiceInput('uniqueSound')"
                      [disabled]="isRecording()"
                      class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                      [style.border-color]="theme().accent">
                <i class="fas fa-microphone"></i>
              </button>
            </label>
            <input type="text" [value]="editableProfile().uniqueSound" (input)="updateField('uniqueSound', $event)" 
                   class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                   [style.border-color]="theme().accent + '50'"
                   placeholder="e.g., Melodic trap with jazzy undertones">
          </div>
        </div>

        <div class="form-group">
          <label class="block text-sm font-medium mb-2">Secondary Genres (Select all that apply)</label>
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 p-4 border rounded-md" [style.border-color]="theme().accent + '30'">
            <label *ngFor="let genre of ALL_GENRES" class="flex items-center gap-2 cursor-pointer hover:bg-white/5 p-2 rounded">
              <input type="checkbox" [checked]="isArrayFieldChecked('secondaryGenres', genre)" 
                     (change)="updateArrayField('secondaryGenres', genre, $event)"
                     class="accent-purple-500">
              <span class="text-sm">{{ genre }}</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label class="block text-sm font-medium mb-2 flex items-center justify-between">
            <span>Musical Influences / Inspirations</span>
            <button *ngIf="voiceSupported()" 
                    (click)="startVoiceInput('musicalInfluences')"
                    [disabled]="isRecording()"
                    class="text-xs px-2 py-1 border rounded hover:bg-white/10"
                    [style.border-color]="theme().accent">
              <i class="fas fa-microphone"></i> Voice Input
            </button>
          </label>
          <textarea [value]="editableProfile().musicalInfluences" (input)="updateField('musicalInfluences', $event)" 
                    rows="3" 
                    class="w-full p-3 bg-black/50 border rounded-md focus:outline-none focus:ring-2 transition-all" 
                    [style.border-color]="theme().accent + '50'"
                    placeholder="List artists, producers, or movements that inspire your music"></textarea>
        </div>
      </div>

      <!-- Rest of sections follow same pattern from previous implementation -->
      <!-- For brevity, keeping just the structure indicators -->
      <div *ngIf="activeSection() === 'expertise'" class="space-y-6 animate-fadeIn">
        <p class="text-center opacity-60">Experience & Skills section - (same as previous implementation)</p>
      </div>
      <div *ngIf="activeSection() === 'career'" class="space-y-6 animate-fadeIn">
        <p class="text-center opacity-60">Career & Goals section - (same as previous implementation)</p>
      </div>
      <!-- Add all other sections here -->

    </div>

    <!-- Save Button (Fixed at bottom) -->
    <div class="p-4 border-t-2 bg-black/50" [style.border-color]="theme().accent">
      <button (click)="saveProfile()" 
              class="w-full p-4 border-2 text-lg font-bold hover:text-black disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-[1.02] active:scale-[0.98]" 
              [style.border-color]="theme().accent" 
              [style.background]="saveStatus() !== 'idle' ? theme().accent + '40' : 'transparent'"
              [style.color]="saveStatus() === 'saved' ? theme().accent : 'inherit'"
              [class.hover:bg-purple-600]="saveStatus() === 'idle'"
              [disabled]="saveStatus() !== 'idle'">
        <span *ngIf="saveStatus() === 'idle'" class="flex items-center justify-center gap-2">
          <i class="fas fa-save"></i> SAVE PROFILE & SYNC WITH S.M.U.V.E.
        </span>
        <span *ngIf="saveStatus() === 'saving'" class="flex items-center justify-center gap-2">
          <i class="fas fa-spinner fa-spin"></i> SYNCING PROFILE...
        </span>
        <span *ngIf="saveStatus() === 'saved'" class="flex items-center justify-center gap-2">
          <i class="fas fa-check-circle"></i> PROFILE SAVED! S.M.U.V.E. IS NOW PERSONALIZED FOR YOU
        </span>
      </button>
      <p class="text-center text-xs mt-2 opacity-60">
        <i class="fas fa-shield-alt"></i> Your data is securely stored. Profile completeness: {{ profileCompleteness() }}%
      </p>
    </div>
  </div>

</div>

<style>
  .animate-fadeIn {
    animation: fadeIn 0.3s ease-in;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    height: 4px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 2px;
  }
</style>